<h1>所有课题组</h1>
<table border="1">
    <!-- 属性名 -->
    <tr>
        {% for col in groups[0] %}
        <td>{{ col }}</td>
        {% endfor %}
    </tr>
    <!-- 属性值 -->
    {% for row in groups[1:] %}
        <tr>
            {% for col in row %}
            <td>{{ col }}</td>
            {% endfor %}
            <td>
                <button type="button" class="btn" id="join">加入</button>
            </td>
        </tr>
    {% endfor %}
    </table>
    <p id="message"></p>

    
    <script src="../static/js/jquery-1.11.1.min.js"></script>
    <script>
        /*function clickTest(node) {
            var tr = node.parentNode.parentNode;
            // alert(tr.rowIndex);
            // alert(tr.cells[0].innerText);
            window.alert("您向课题组："+tr.cells[2].innerText+" 发送了加入申请，请等待老师批准。");
        }*/

        // 【TO DO 如果是每一行配备一个按钮，那么怎么将这一行的信息存到数据库里面去……】
        // 【1.找到该行课题组的关键数据 2.利用Ajax发回路由函数 3.在路由函数处调用数据库函数】
        $(function() {
            $('.btn').click(function() {    // 这里如果用join id的话，只能取到第一个按钮
                // var leaderID = $(this).parent().prev().val();
                var leader_content = $(this).parent().parent().children(":first");
                var group_content = $(this).parent().parent().children().eq(1);
                leader_content.css('background-color', 'red');
                group_content.css('background-color', 'blue');
                var leaderID = leader_content.text();
                var groupID = group_content.text();

                $.ajax({
                    async:"fales",
                    type:"POST",
                    url:"/allgroup",
                    data: {
                        "leaderID":leaderID,
                        "groupID":groupID
                    },

                    // 【TO DO 若返回值为joined，弹窗提示已在该课题组中】
                    // 【TO DO 若返回值为applied，弹窗提示申请已发送】

                    success:function(data) {
                        if (data == "joined") {
                            $("#message").html('你已经加入该课题组！');
                        } else if (data == "applied") {
                            $("#message").html('您向课题组发送了加入申请，请等待老师批准。');
                        }
                    }
                });
            });
        });
    </script>